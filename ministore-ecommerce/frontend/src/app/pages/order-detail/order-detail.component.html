<div class="order-detail-page">
  <div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <button class="btn btn-outline-secondary" (click)="goBack()">
        <i class="bi bi-arrow-left me-2"></i>
        Quay lại
      </button>
      <h1 class="page-title mb-0">Chi tiết đơn hàng</h1>
      <div></div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3 text-muted">Đang tải chi tiết đơn hàng...</p>
      </div>
    }

    <!-- Error State -->
    @if (error && !isLoading) {
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ error }}
        <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadOrderDetail()">
          Thử lại
        </button>
      </div>
    }

    <!-- Order Detail -->
    @if (order && !isLoading && !error) {
      <div class="order-detail-card">
        <!-- Order Header -->
        <div class="order-header">
          <div class="order-info">
            <h2 class="order-number">Đơn hàng #{{ order.orderNumber }}</h2>
            <p class="order-date mb-0">
              <i class="bi bi-calendar-event me-2"></i>
              {{ formatDate(order.orderDate) }}
            </p>
          </div>
          <div class="order-status">
            <span class="badge" [ngClass]="getStatusClass(order.status)">
              {{ getStatusText(order.status) }}
            </span>
          </div>
        </div>

        <div class="order-content">
          <div class="row">
            <!-- Order Items -->
            <div class="col-lg-8">
              <div class="section">
                <h4 class="section-title">Sản phẩm đã đặt</h4>
                <div class="order-items">
                  @for (item of order.items; track item.id) {
                    <div class="order-item">
                      <div class="item-image">
                        <img [src]="item.product.imageUrl" [alt]="item.product.name" 
                             class="img-fluid rounded" loading="lazy">
                      </div>
                      <div class="item-details">
                        <h5 class="item-name">{{ item.product.name }}</h5>
                        <p class="item-description text-muted">{{ item.product.description }}</p>
                        <div class="item-info">
                          <span class="item-price">{{ formatPrice(item.price) }}</span>
                          <span class="item-quantity">× {{ item.quantity }}</span>
                          <span class="item-subtotal">{{ formatPrice(item.subtotal) }}</span>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>

              <!-- Shipping Address -->
              <div class="section">
                <h4 class="section-title">Địa chỉ giao hàng</h4>
                <div class="shipping-address">
                  <div class="address-info">
                    <h6 class="recipient-name">{{ order.shippingAddress.fullName }}</h6>
                    <p class="recipient-phone">
                      <i class="bi bi-telephone me-2"></i>
                      {{ order.shippingAddress.phone }}
                    </p>
                    <p class="address-text">
                      <i class="bi bi-geo-alt me-2"></i>
                      {{ order.shippingAddress.address }}
                      @if (order.shippingAddress.district) {
                        , {{ order.shippingAddress.district }}
                      }
                      @if (order.shippingAddress.ward) {
                        , {{ order.shippingAddress.ward }}
                      }
                      , {{ order.shippingAddress.city }}
                      @if (order.shippingAddress.postalCode) {
                        ({{ order.shippingAddress.postalCode }})
                      }
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
              <div class="order-summary">
                <h4 class="section-title">Tổng kết đơn hàng</h4>
                
                <div class="summary-section">
                  <div class="summary-row">
                    <span>Tạm tính:</span>
                    <span>{{ formatPrice(order.totalAmount) }}</span>
                  </div>
                  
                  <div class="summary-row">
                    <span>Phí vận chuyển:</span>
                    <span>{{ formatPrice(0) }}</span>
                  </div>
                  
                  <hr>
                  
                  <div class="summary-row total">
                    <strong>Tổng cộng:</strong>
                    <strong>{{ formatPrice(order.totalAmount) }}</strong>
                  </div>
                </div>

                <!-- Payment Info -->
                <div class="payment-info">
                  <h5>Thông tin thanh toán</h5>
                  <p class="text-muted">Thanh toán khi nhận hàng (COD)</p>
                </div>

                <!-- Order Actions -->
                <div class="order-actions">
                  <button class="btn btn-outline-primary w-100" (click)="goBack()">
                    <i class="bi bi-list me-2"></i>
                    Xem tất cả đơn hàng
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
