<div class="order-detail-page">
  <div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <button class="btn btn-outline-secondary" (click)="goBack()">
        <i class="bi bi-arrow-left me-2"></i>
        Quay l·∫°i
      </button>
      <h1 class="page-title mb-0">Chi ti·∫øt ƒë∆°n h√†ng</h1>
      <div></div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">ƒêang t·∫£i...</span>
        </div>
        <p class="mt-3 text-muted">ƒêang t·∫£i chi ti·∫øt ƒë∆°n h√†ng...</p>
      </div>
    }

    <!-- Error State -->
    @if (error && !isLoading) {
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ error }}
        <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadOrderDetail()">
          Th·ª≠ l·∫°i
        </button>
      </div>
    }

    <!-- Order Detail -->
    @if (order && !isLoading && !error) {
      <div class="order-detail-card">
        <!-- Order Header -->
        <div class="order-header">
          <div class="order-info">
            <h2 class="order-number">ƒê∆°n h√†ng #{{ order.orderNumber }}</h2>
            <p class="order-date mb-0">
              <i class="bi bi-calendar-event me-2"></i>
              {{ formatDate(order.orderDate) }}
            </p>
          </div>
          <div class="order-status">
            <span class="badge" [ngClass]="getStatusClass(order.status)">
              {{ getStatusText(order.status) }}
            </span>
          </div>
        </div>

        <div class="order-content">
          <div class="row">
            <!-- Order Items -->
            <div class="col-lg-8">
              <div class="section">
                <h4 class="section-title">S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</h4>
                <div class="order-items">
                  @for (item of order.items; track item.id) {
                    <div class="order-item">
                      <div class="item-image">
                        <img [src]="item.product.imageUrl" [alt]="item.product.name" 
                             class="img-fluid rounded" loading="lazy" appImageFallback>
                      </div>
                      <div class="item-details">
                        <h5 class="item-name">{{ item.product.name }}</h5>
                        <p class="item-description text-muted">{{ item.product.description }}</p>
                        <div class="item-info">
                          <span class="item-price">{{ formatPrice(item.price) }}</span>
                          <span class="item-quantity">√ó {{ item.quantity }}</span>
                          <span class="item-subtotal">{{ formatPrice(item.subtotal) }}</span>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>

              <!-- Shipping Address -->
              <div class="section">
                <h4 class="section-title">ƒê·ªãa ch·ªâ giao h√†ng</h4>
                <div class="shipping-address">
                  <div class="address-info">
                    <h6 class="recipient-name">{{ order.shippingAddress.fullName }}</h6>
                    <p class="recipient-phone">
                      <i class="bi bi-telephone me-2"></i>
                      {{ order.shippingAddress.phone }}
                    </p>
                    <p class="address-text">
                      <i class="bi bi-geo-alt me-2"></i>
                      {{ order.shippingAddress.address }}
                      @if (order.shippingAddress.district) {
                        , {{ order.shippingAddress.district }}
                      }
                      @if (order.shippingAddress.ward) {
                        , {{ order.shippingAddress.ward }}
                      }
                      , {{ order.shippingAddress.city }}
                      @if (order.shippingAddress.postalCode) {
                        ({{ order.shippingAddress.postalCode }})
                      }
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
              <div class="order-summary">
                <h4 class="section-title">T·ªïng k·∫øt ƒë∆°n h√†ng</h4>
                
                <div class="summary-section">
                  <div class="summary-row">
                    <span>T·∫°m t√≠nh:</span>
                    <span>{{ formatPrice(order.originalAmount || order.totalAmount) }}</span>
                  </div>
                  
                  @if (order.discountCode && order.discountAmount) {
                    <div class="discount-section">
                      <div class="summary-row discount-row">
                        <span class="text-success fw-bold">
                          <i class="bi bi-ticket-perforated me-1"></i>
                          Gi·∫£m gi√° ({{ order.discountCode }}):
                        </span>
                        <span class="text-success fw-bold">-{{ formatPrice(order.discountAmount) }}</span>
                      </div>
                      <div class="discount-info">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          M√£ gi·∫£m gi√° ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng th√†nh c√¥ng
                        </small>
                      </div>
                    </div>
                  }
                  
                  <div class="summary-row">
                    <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                    <span>{{ formatPrice(0) }}</span>
                  </div>
                  
                  <hr>
                  
                  @if (order.discountCode && order.discountAmount) {
                    <div class="summary-row">
                      <span class="text-muted">T·ªïng c·ªông (ch∆∞a gi·∫£m):</span>
                      <span class="text-muted text-decoration-line-through">{{ formatPrice(order.originalAmount || order.totalAmount) }}</span>
                    </div>
                  }
                  
                  <div class="summary-row total">
                    <strong>T·ªïng c·ªông{{ order.discountCode ? ' (ƒë√£ gi·∫£m gi√°)' : '' }}:</strong>
                    <strong class="{{ order.discountCode ? 'text-success' : 'text-primary' }} fs-5">{{ formatPrice(order.totalAmount) }}</strong>
                  </div>
                  
                  @if (order.discountCode && order.discountAmount) {
                    <div class="savings-info mt-3 p-3 bg-success bg-opacity-10 border border-success rounded">
                      <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-gift text-success me-2 fs-5"></i>
                        <strong class="text-success">
                          üéâ B·∫°n ƒë√£ ti·∫øt ki·ªám ƒë∆∞·ª£c {{ formatPrice(order.discountAmount) }} v·ªõi m√£ {{ order.discountCode }}!
                        </strong>
                      </div>
                    </div>
                  }
                </div>

                <!-- Payment Info -->
                <div class="payment-info">
                  <h5>Th√¥ng tin thanh to√°n</h5>
                  <p class="text-muted">Thanh to√°n khi nh·∫≠n h√†ng (COD)</p>
                </div>

                <!-- Order Actions -->
                <div class="order-actions">
                  <button class="btn btn-outline-primary w-100" (click)="goBack()">
                    <i class="bi bi-list me-2"></i>
                    Xem t·∫•t c·∫£ ƒë∆°n h√†ng
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
