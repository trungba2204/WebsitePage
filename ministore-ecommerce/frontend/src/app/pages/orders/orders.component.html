<div class="orders-page">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="page-title">Đơn hàng của tôi</h1>
      <button class="btn btn-outline-primary" (click)="loadOrders()">
        <i class="bi bi-arrow-clockwise me-2"></i>
        Làm mới
      </button>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3 text-muted">Đang tải danh sách đơn hàng...</p>
      </div>
    }

    <!-- Error State -->
    @if (error && !isLoading) {
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ error }}
        <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadOrders()">
          Thử lại
        </button>
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && !error && orders.length === 0) {
      <div class="text-center py-5">
        <i class="bi bi-box-seam display-1 text-muted"></i>
        <h3 class="mt-3 text-muted">Chưa có đơn hàng nào</h3>
        <p class="text-muted">Bạn chưa có đơn hàng nào. Hãy mua sắm để tạo đơn hàng đầu tiên!</p>
        <a routerLink="/products" class="btn btn-primary">
          <i class="bi bi-shop me-2"></i>
          Mua sắm ngay
        </a>
      </div>
    }

    <!-- Orders List -->
    @if (!isLoading && !error && orders.length > 0) {
      <div class="orders-list">
        @for (order of orders; track order.id) {
          <div class="order-card">
            <div class="order-header">
              <div class="order-info">
                <h5 class="order-number">Đơn hàng #{{ order.orderNumber }}</h5>
                <p class="order-date mb-0">
                  <i class="bi bi-calendar-event me-2"></i>
                  {{ formatDate(order.orderDate) }}
                </p>
              </div>
              <div class="order-status">
                <span class="badge" [ngClass]="getStatusClass(order.status)">
                  {{ getStatusText(order.status) }}
                </span>
              </div>
            </div>

            <div class="order-body">
              <div class="row">
                <!-- Order Items -->
                <div class="col-md-8">
                  <h6 class="mb-3">Sản phẩm:</h6>
                  <div class="order-items">
                    @for (item of order.items; track item.id) {
                      <div class="order-item">
                        <div class="item-image">
                          <img [src]="item.product.imageUrl" [alt]="item.product.name" 
                               class="img-fluid rounded" loading="lazy">
                        </div>
                        <div class="item-details">
                          <h6 class="item-name">{{ item.product.name }}</h6>
                          <p class="item-price mb-1">
                            {{ formatPrice(item.price) }} × {{ item.quantity }}
                          </p>
                          <p class="item-subtotal mb-0 fw-bold">
                            {{ formatPrice(item.subtotal) }}
                          </p>
                        </div>
                      </div>
                    }
                  </div>
                </div>

                <!-- Order Summary -->
                <div class="col-md-4">
                  <div class="order-summary">
                    <h6 class="mb-3">Tổng kết đơn hàng:</h6>
                    
                    <div class="summary-row">
                      <span>Tạm tính:</span>
                      <span>{{ formatPrice(order.totalAmount) }}</span>
                    </div>
                    
                    <div class="summary-row">
                      <span>Phí vận chuyển:</span>
                      <span>{{ formatPrice(0) }}</span>
                    </div>
                    
                    <hr>
                    
                    <div class="summary-row total">
                      <strong>Tổng cộng:</strong>
                      <strong>{{ formatPrice(order.totalAmount) }}</strong>
                    </div>

                    <div class="order-actions mt-3">
                      <a [routerLink]="['/orders', order.id]" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-eye me-1"></i>
                        Xem chi tiết
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Shipping Address -->
              <div class="shipping-info mt-3">
                <h6 class="mb-2">Địa chỉ giao hàng:</h6>
                <p class="mb-0 text-muted">
                  {{ order.shippingAddress.fullName }} - {{ order.shippingAddress.phone }}<br>
                  {{ order.shippingAddress.address }}, {{ order.shippingAddress.city }}
                </p>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
