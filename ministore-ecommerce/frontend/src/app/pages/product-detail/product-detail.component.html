<div class="product-detail-page">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a routerLink="/">Trang chủ</a>
        </li>
        <li class="breadcrumb-item">
          <a routerLink="/products">Sản phẩm</a>
        </li>
        @if (product) {
          <li class="breadcrumb-item active">{{ product.name }}</li>
        }
      </ol>
    </nav>

    @if (isLoading) {
      <div class="loading text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3">Đang tải thông tin sản phẩm...</p>
      </div>
    } @else if (product) {
      <div class="row">
        <!-- Product Images -->
        <div class="col-lg-6">
          <div class="product-images">
            <!-- Main Image -->
            <div class="main-image">
              <img [src]="product.imageUrl" [alt]="product.name" class="img-fluid" />
              @if (product.stock === 0) {
                <div class="out-of-stock-overlay">
                  <span>Hết hàng</span>
                </div>
              }
            </div>
            
            <!-- Thumbnail Images (placeholder for future gallery) -->
            <div class="thumbnail-images">
              <div class="thumbnail active">
                <img [src]="product.imageUrl" [alt]="product.name" />
              </div>
              <!-- Add more thumbnails here when implementing image gallery -->
            </div>
          </div>
        </div>

        <!-- Product Info -->
        <div class="col-lg-6">
          <div class="product-info">
            <!-- Category -->
            <div class="product-category">
              <a routerLink="/products" [queryParams]="{categoryId: product.category.id}">
                {{ product.category.name }}
              </a>
            </div>
            
            <!-- Product Name -->
            <h1 class="product-name">{{ product.name }}</h1>
            
            <!-- Rating -->
            @if (product.rating) {
              <div class="product-rating">
                <div class="stars">
                  @for (star of [1,2,3,4,5]; track star) {
                    <i class="bi" 
                       [ngClass]="star <= (product.rating || 0) ? 'bi-star-fill' : 'bi-star'"></i>
                  }
                </div>
                <span class="rating-value">{{ product.rating }}</span>
                @if (product.reviews) {
                  <span class="reviews">({{ product.reviews }} đánh giá)</span>
                }
              </div>
            }

            <!-- Price -->
            <div class="product-price">
              <span class="current-price">{{ formatPrice(product.price) }}</span>
              @if (product.price > 1000000) {
                <span class="original-price">{{ formatPrice(product.price * 1.2) }}</span>
                <span class="discount-badge">-17%</span>
              }
            </div>

            <!-- Stock Status -->
            <div class="stock-status">
              @if (product.stock > 0) {
                <i class="bi bi-check-circle text-success"></i>
                <span class="text-success">Còn {{ product.stock }} sản phẩm</span>
              } @else {
                <i class="bi bi-x-circle text-danger"></i>
                <span class="text-danger">Hết hàng</span>
              }
            </div>

            <!-- Description -->
            <div class="product-description">
              <p>{{ product.description }}</p>
            </div>

            <!-- Quantity and Add to Cart -->
            @if (product.stock > 0) {
              <div class="purchase-section">
                <div class="quantity-selector">
                  <label class="form-label">Số lượng:</label>
                  <div class="quantity-controls">
                    <button 
                      type="button" 
                      class="btn btn-outline-secondary"
                      (click)="decrementQuantity()" 
                      [disabled]="quantity <= 1">
                      <i class="bi bi-dash"></i>
                    </button>
                    <input 
                      type="number" 
                      class="form-control quantity-input" 
                      [(ngModel)]="quantity" 
                      min="1" 
                      [max]="product.stock" 
                      readonly />
                    <button 
                      type="button" 
                      class="btn btn-outline-secondary"
                      (click)="incrementQuantity()" 
                      [disabled]="quantity >= product.stock">
                      <i class="bi bi-plus"></i>
                    </button>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                  <button 
                    class="btn btn-primary btn-lg btn-add-cart"
                    [disabled]="isAddingToCart"
                    (click)="addToCart()">
                    @if (isAddingToCart) {
                      <span class="spinner-border spinner-border-sm me-2"></span>
                      Đang thêm...
                    } @else {
                      <i class="bi bi-cart-plus me-2"></i>
                      Thêm vào giỏ hàng
                    }
                  </button>
                  
                  <button class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-heart me-2"></i>
                    Yêu thích
                  </button>
                </div>
              </div>
            }

            <!-- Product Features -->
            <div class="product-features">
              <div class="feature-item">
                <i class="bi bi-truck text-primary"></i>
                <span>Miễn phí vận chuyển</span>
              </div>
              <div class="feature-item">
                <i class="bi bi-arrow-clockwise text-primary"></i>
                <span>Đổi trả trong 30 ngày</span>
              </div>
              <div class="feature-item">
                <i class="bi bi-shield-check text-primary"></i>
                <span>Bảo hành chính hãng</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Tabs -->
      <div class="product-tabs mt-5">
        <ul class="nav nav-tabs" id="productTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
              Mô tả chi tiết
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
              Thông số kỹ thuật
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
              Đánh giá ({{ product.reviews || 0 }})
            </button>
          </li>
        </ul>
        <div class="tab-content" id="productTabsContent">
          <div class="tab-pane fade show active" id="description" role="tabpanel">
            <div class="tab-content-body">
              <p>{{ product.description }}</p>
              <p>Đây là một sản phẩm chất lượng cao với thiết kế hiện đại và tính năng tiên tiến. Sản phẩm được sản xuất theo tiêu chuẩn quốc tế và đảm bảo chất lượng tốt nhất cho người dùng.</p>
            </div>
          </div>
          <div class="tab-pane fade" id="specifications" role="tabpanel">
            <div class="tab-content-body">
              <table class="table">
                <tbody>
                  <tr>
                    <td><strong>Thương hiệu</strong></td>
                    <td>{{ product.category.name }}</td>
                  </tr>
                  <tr>
                    <td><strong>Xuất xứ</strong></td>
                    <td>Việt Nam</td>
                  </tr>
                  <tr>
                    <td><strong>Bảo hành</strong></td>
                    <td>12 tháng</td>
                  </tr>
                  <tr>
                    <td><strong>Trọng lượng</strong></td>
                    <td>1.2 kg</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="reviews" role="tabpanel">
            <div class="tab-content-body">
              <div class="reviews-summary">
                <div class="average-rating">
                  <span class="rating-number">{{ product.rating || 0 }}</span>
                  <div class="stars">
                    @for (star of [1,2,3,4,5]; track star) {
                      <i class="bi" 
                         [ngClass]="star <= (product.rating || 0) ? 'bi-star-fill' : 'bi-star'"></i>
                    }
                  </div>
                  <p>Dựa trên {{ product.reviews || 0 }} đánh giá</p>
                </div>
              </div>
              <div class="reviews-list">
                <p class="text-muted">Chưa có đánh giá nào. Hãy là người đầu tiên đánh giá sản phẩm này!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <div class="empty-state text-center py-5">
        <i class="bi bi-exclamation-circle text-muted" style="font-size: 4rem;"></i>
        <h3 class="mt-3">Không tìm thấy sản phẩm</h3>
        <p class="text-muted">Sản phẩm bạn đang tìm kiếm không tồn tại hoặc đã bị xóa.</p>
        <a routerLink="/products" class="btn btn-primary">Xem tất cả sản phẩm</a>
      </div>
    }
  </div>
</div>

