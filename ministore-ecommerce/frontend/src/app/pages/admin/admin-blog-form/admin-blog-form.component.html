<div class="admin-blog-form">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <nav class="breadcrumb">
          <a routerLink="/admin/dashboard" class="breadcrumb-item">Dashboard</a>
          <a routerLink="/admin/blogs" class="breadcrumb-item">Blog</a>
          <span class="breadcrumb-item active">
            {{ isEditMode ? 'Sửa bài viết' : 'Viết bài mới' }}
          </span>
        </nav>
        <h1 class="page-title">
          {{ isEditMode ? 'Sửa bài viết' : 'Viết bài mới' }}
        </h1>
        <p class="page-subtitle">
          {{ isEditMode ? 'Cập nhật nội dung bài viết' : 'Tạo bài viết mới cho blog' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Form -->
  <div class="form-container">
    @if (isLoading) {
      <div class="loading-state">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3">Đang tải thông tin bài viết...</p>
      </div>
    } @else {
      <form (ngSubmit)="onSubmit()" #blogFormRef="ngForm" class="blog-form">
        <div class="row">
          <!-- Left Column -->
          <div class="col-lg-8">
            <!-- Basic Information -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-pencil-square me-2"></i>
                Thông tin bài viết
              </h3>
              
              <div class="row g-3">
                <div class="col-md-12">
                  <label for="title" class="form-label required">Tiêu đề</label>
                  <input
                    type="text"
                    id="title"
                    class="form-control"
                    [(ngModel)]="blogForm.title"
                    name="title"
                    placeholder="Nhập tiêu đề bài viết"
                    required>
                </div>

                <div class="col-md-6">
                  <label for="author" class="form-label required">Tác giả</label>
                  <input
                    type="text"
                    id="author"
                    class="form-control"
                    [(ngModel)]="blogForm.author"
                    name="author"
                    placeholder="Tên tác giả"
                    required>
                </div>

                <div class="col-md-6">
                  <label for="category" class="form-label required">Danh mục</label>
                  <input
                    type="text"
                    id="category"
                    class="form-control"
                    [(ngModel)]="blogForm.category"
                    name="category"
                    placeholder="Danh mục bài viết"
                    required>
                </div>

                <div class="col-md-12">
                  <label for="excerpt" class="form-label required">Tóm tắt</label>
                  <textarea
                    id="excerpt"
                    class="form-control"
                    [(ngModel)]="blogForm.excerpt"
                    name="excerpt"
                    rows="3"
                    placeholder="Mô tả ngắn gọn về nội dung bài viết"
                    required></textarea>
                  <div class="form-text">
                    <button type="button" class="btn btn-sm btn-outline-secondary" (click)="generateExcerpt()">
                      <i class="bi bi-magic"></i> Tự động tạo từ nội dung
                    </button>
                  </div>
                </div>

                <div class="col-md-12">
                  <label for="content" class="form-label required">Nội dung</label>
                  <textarea
                    id="content"
                    class="form-control content-editor"
                    [(ngModel)]="blogForm.content"
                    name="content"
                    rows="15"
                    placeholder="Nhập nội dung bài viết..."
                    required></textarea>
                  <div class="form-text">
                    Sử dụng HTML để định dạng nội dung (in đậm, nghiêng, links, etc.)
                  </div>
                </div>
              </div>
            </div>

            <!-- Tags -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-tags me-2"></i>
                Tags
              </h3>
              
              <div class="tags-input">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="tagInput"
                    name="tagInput"
                    placeholder="Nhập tag và nhấn Enter"
                    (keypress)="onTagInputKeyPress($event)">
                  <button class="btn btn-outline-secondary" type="button" (click)="addTag()">
                    <i class="bi bi-plus"></i> Thêm
                  </button>
                </div>
                
                @if (blogForm.tags.length > 0) {
                  <div class="tags-list">
                    @for (tag of blogForm.tags; track tag) {
                      <span class="tag">
                        {{ tag }}
                        <button type="button" class="tag-remove" (click)="removeTag(tag)">
                          <i class="bi bi-x"></i>
                        </button>
                      </span>
                    }
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="col-lg-4">
            <!-- Publishing Options -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-broadcast me-2"></i>
                Xuất bản
              </h3>
              
              <div class="publishing-options">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="published"
                    [(ngModel)]="blogForm.published"
                    name="published">
                  <label class="form-check-label" for="published">
                    Xuất bản ngay
                  </label>
                </div>
                <div class="form-text">
                  {{ blogForm.published ? 'Bài viết sẽ được hiển thị công khai' : 'Lưu dưới dạng bản nháp' }}
                </div>
              </div>
            </div>

            <!-- Featured Image -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-image me-2"></i>
                Hình ảnh đại diện
              </h3>
              
              <div class="image-preview">
                <div class="preview-container">
                  <img [src]="previewImage()" [alt]="blogForm.title || 'Bài viết'" class="preview-image">
                  <div class="preview-overlay">
                    <div class="preview-info">
                      <i class="bi bi-eye"></i>
                      <span>Xem trước</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="imageUrl" class="form-label">URL hình ảnh</label>
                <input
                  type="url"
                  id="imageUrl"
                  class="form-control"
                  [(ngModel)]="blogForm.imageUrl"
                  name="imageUrl"
                  placeholder="https://example.com/image.jpg">
              </div>
            </div>

            <!-- Author Info -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-person me-2"></i>
                Thông tin tác giả
              </h3>
              
              <div class="author-preview">
                <div class="author-avatar-preview">
                  <img [src]="previewAuthorAvatar()" [alt]="blogForm.author || 'Tác giả'" class="author-avatar">
                </div>
                <div class="author-info">
                  <div class="author-name">{{ blogForm.author || 'Chưa nhập tên' }}</div>
                  <div class="author-role">Tác giả</div>
                </div>
              </div>

              <div class="form-group">
                <label for="authorAvatar" class="form-label">Avatar tác giả</label>
                <input
                  type="url"
                  id="authorAvatar"
                  class="form-control"
                  [(ngModel)]="blogForm.authorAvatar"
                  name="authorAvatar"
                  placeholder="https://example.com/avatar.jpg">
              </div>
            </div>

            <!-- Blog Summary -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-list-check me-2"></i>
                Tóm tắt bài viết
              </h3>
              
              <div class="summary-card">
                <div class="summary-item">
                  <span class="label">Tiêu đề:</span>
                  <span class="value">{{ blogForm.title || 'Chưa nhập' }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Tác giả:</span>
                  <span class="value">{{ blogForm.author || 'Chưa nhập' }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Danh mục:</span>
                  <span class="value">{{ blogForm.category || 'Chưa nhập' }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Tags:</span>
                  <span class="value">{{ blogForm.tags.length }} tags</span>
                </div>
                <div class="summary-item">
                  <span class="label">Trạng thái:</span>
                  <span class="value">
                    <span [class]="'badge ' + (blogForm.published ? 'bg-success' : 'bg-warning')">
                      {{ blogForm.published ? 'Xuất bản' : 'Bản nháp' }}
                    </span>
                  </span>
                </div>
                <div class="summary-item">
                  <span class="label">Độ dài:</span>
                  <span class="value">{{ blogForm.content.length }} ký tự</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <div class="actions-left">
            <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">
              <i class="bi bi-arrow-left me-2"></i>
              Quay lại
            </button>
          </div>
          <div class="actions-right">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="isSaving">
              @if (isSaving) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Đang lưu...
              } @else {
                <i class="bi bi-check-circle me-2"></i>
                {{ isEditMode ? 'Cập nhật bài viết' : 'Tạo bài viết' }}
              }
            </button>
          </div>
        </div>
      </form>
    }
  </div>
</div>
