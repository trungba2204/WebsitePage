<div class="admin-product-form">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <nav class="breadcrumb">
          <a routerLink="/admin/dashboard" class="breadcrumb-item">Dashboard</a>
          <a routerLink="/admin/products" class="breadcrumb-item">Sản phẩm</a>
          <span class="breadcrumb-item active">
            {{ isEditMode ? 'Sửa sản phẩm' : 'Thêm sản phẩm mới' }}
          </span>
        </nav>
        <h1 class="page-title">
          {{ isEditMode ? 'Sửa sản phẩm' : 'Thêm sản phẩm mới' }}
        </h1>
        <p class="page-subtitle">
          {{ isEditMode ? 'Cập nhật thông tin sản phẩm' : 'Thêm sản phẩm mới vào cửa hàng' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Form -->
  <div class="form-container">
    @if (isLoading) {
      <div class="loading-state">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Đang tải...</span>
        </div>
        <p class="mt-3">Đang tải thông tin sản phẩm...</p>
      </div>
    } @else {
      <form (ngSubmit)="onSubmit()" #productFormRef="ngForm" class="product-form">
        <div class="row">
          <!-- Left Column -->
          <div class="col-lg-8">
            <!-- Basic Information -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-info-circle me-2"></i>
                Thông tin cơ bản
              </h3>
              
              <div class="row g-3">
                <div class="col-md-12">
                  <label for="name" class="form-label required">Tên sản phẩm</label>
                  <input
                    type="text"
                    id="name"
                    class="form-control"
                    [(ngModel)]="productForm.name"
                    name="name"
                    placeholder="Nhập tên sản phẩm"
                    required>
                </div>

                <div class="col-md-12">
                  <label for="description" class="form-label required">Mô tả</label>
                  <textarea
                    id="description"
                    class="form-control"
                    [(ngModel)]="productForm.description"
                    name="description"
                    rows="4"
                    placeholder="Nhập mô tả chi tiết về sản phẩm"
                    required></textarea>
                </div>

                <div class="col-md-6">
                  <label for="price" class="form-label required">Giá (VNĐ)</label>
                  <input
                    type="number"
                    id="price"
                    class="form-control"
                    [(ngModel)]="productForm.price"
                    name="price"
                    min="0"
                    step="1000"
                    placeholder="Nhập giá sản phẩm"
                    required>
                  <div class="form-text">
                    Hiển thị: {{ formatPrice(productForm.price) }}
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="stock" class="form-label required">Số lượng tồn kho</label>
                  <input
                    type="number"
                    id="stock"
                    class="form-control"
                    [(ngModel)]="productForm.stock"
                    name="stock"
                    min="0"
                    placeholder="Nhập số lượng"
                    required>
                </div>

                <div class="col-md-6">
                  <label for="categoryId" class="form-label required">Danh mục</label>
                  <select
                    id="categoryId"
                    class="form-select"
                    [(ngModel)]="productForm.categoryId"
                    name="categoryId"
                    required>
                    <option value="">Chọn danh mục</option>
                    @for (category of categories; track category.id) {
                      <option [value]="category.id">{{ category.name }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label for="imageUrl" class="form-label required">URL hình ảnh</label>
                  <input
                    type="url"
                    id="imageUrl"
                    class="form-control"
                    [(ngModel)]="productForm.imageUrl"
                    name="imageUrl"
                    placeholder="https://example.com/image.jpg"
                    required>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-star me-2"></i>
                Thông tin bổ sung
              </h3>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="rating" class="form-label">Đánh giá (0-5)</label>
                  <input
                    type="number"
                    id="rating"
                    class="form-control"
                    [(ngModel)]="productForm.rating"
                    name="rating"
                    min="0"
                    max="5"
                    step="0.1"
                    placeholder="0">
                  <div class="form-text">Đánh giá từ 0 đến 5 sao</div>
                </div>

                <div class="col-md-6">
                  <label for="reviews" class="form-label">Số lượt đánh giá</label>
                  <input
                    type="number"
                    id="reviews"
                    class="form-control"
                    [(ngModel)]="productForm.reviews"
                    name="reviews"
                    min="0"
                    placeholder="0">
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="col-lg-4">
            <!-- Image Preview -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-image me-2"></i>
                Xem trước hình ảnh
              </h3>
              
              <div class="image-preview">
                <div class="preview-container">
                  <img [src]="previewImage()" [alt]="productForm.name || 'Sản phẩm'" class="preview-image">
                  <div class="preview-overlay">
                    <div class="preview-info">
                      <i class="bi bi-eye"></i>
                      <span>Xem trước</span>
                    </div>
                  </div>
                </div>
                <div class="preview-text">
                  <small class="text-muted">
                    Hình ảnh sẽ hiển thị như này trên trang web
                  </small>
                </div>
              </div>
            </div>

            <!-- Product Summary -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="bi bi-list-check me-2"></i>
                Tóm tắt sản phẩm
              </h3>
              
              <div class="summary-card">
                <div class="summary-item">
                  <span class="label">Tên:</span>
                  <span class="value">{{ productForm.name || 'Chưa nhập' }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Danh mục:</span>
                  <span class="value">
                    {{ getCategoryName(productForm.categoryId) }}
                  </span>
                </div>
                <div class="summary-item">
                  <span class="label">Giá:</span>
                  <span class="value">{{ formatPrice(productForm.price) }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Tồn kho:</span>
                  <span class="value">{{ productForm.stock }} sản phẩm</span>
                </div>
                @if (productForm.rating > 0) {
                  <div class="summary-item">
                    <span class="label">Đánh giá:</span>
                    <span class="value">
                      <div class="rating-display">
                        @for (star of [1,2,3,4,5]; track star) {
                          <i [class]="'bi ' + (star <= productForm.rating ? 'bi-star-fill' : 'bi-star')"></i>
                        }
                        <span class="rating-text">({{ productForm.rating }})</span>
                      </div>
                    </span>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <div class="actions-left">
            <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">
              <i class="bi bi-arrow-left me-2"></i>
              Quay lại
            </button>
          </div>
          <div class="actions-right">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="isSaving">
              @if (isSaving) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Đang lưu...
              } @else {
                <i class="bi bi-check-circle me-2"></i>
                {{ isEditMode ? 'Cập nhật sản phẩm' : 'Tạo sản phẩm' }}
              }
            </button>
          </div>
        </div>
      </form>
    }
  </div>
</div>
