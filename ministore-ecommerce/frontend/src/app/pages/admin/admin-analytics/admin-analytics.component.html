<div class="admin-analytics">
  <div class="analytics-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-graph-up-arrow"></i>
        Phân Tích & Thống Kê
      </h1>
      <p class="page-subtitle">Theo dõi hiệu suất website và doanh thu</p>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <label class="control-label">Thời gian:</label>
        <select class="form-select" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()">
          @for (period of periods; track period.value) {
            <option [value]="period.value">{{ period.label }}</option>
          }
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
      <p class="loading-text">Đang tải dữ liệu phân tích...</p>
    </div>
  } @else if (analyticsData) {
    
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card views-card">
        <div class="card-icon">
          <i class="bi bi-eye"></i>
        </div>
        <div class="card-content">
          <div class="card-title">Tổng lượt xem</div>
          <div class="card-value">{{ formatNumber(analyticsData.totalViews) }}</div>
          <div class="card-growth positive">
            <i class="bi bi-arrow-up"></i>
            +12%
          </div>
        </div>
      </div>

      <div class="summary-card revenue-card">
        <div class="card-icon">
          <i class="bi bi-currency-dollar"></i>
        </div>
        <div class="card-content">
          <div class="card-title">Tổng doanh thu</div>
          <div class="card-value">{{ formatCurrency(analyticsData.totalRevenue) }}</div>
          <div class="card-growth positive">
            <i class="bi bi-arrow-up"></i>
            +8%
          </div>
        </div>
      </div>

      <div class="summary-card aov-card">
        <div class="card-icon">
          <i class="bi bi-cart-check"></i>
        </div>
        <div class="card-content">
          <div class="card-title">Giá trị đơn hàng TB</div>
          <div class="card-value">{{ formatCurrency(analyticsData.averageOrderValue) }}</div>
          <div class="card-growth neutral">
            <i class="bi bi-dash"></i>
            Trung bình
          </div>
        </div>
      </div>

      <div class="summary-card conversion-card">
        <div class="card-icon">
          <i class="bi bi-graph-up"></i>
        </div>
        <div class="card-content">
          <div class="card-title">Tỷ lệ chuyển đổi</div>
          <div class="card-value">3.2%</div>
          <div class="card-growth positive">
            <i class="bi bi-arrow-up"></i>
            +0.5%
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="row">
        <!-- Views Chart -->
        <div class="col-lg-6 mb-4">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="bi bi-eye"></i>
                Lượt xem theo thời gian
              </h3>
            </div>
            <div class="chart-body">
              <div class="chart-container">
                <div class="simple-chart">
                  <div class="chart-bars">
                    @for (view of analyticsData.views; track view.date) {
                      <div class="chart-bar" [style.height.%]="getViewBarHeight(view.count)">
                        <div class="bar-value">{{ view.count }}</div>
                      </div>
                    }
                  </div>
                  <div class="chart-labels">
                    @for (view of analyticsData.views; track view.date) {
                      <div class="chart-label">{{ formatDate(view.date) }}</div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Revenue Chart -->
        <div class="col-lg-6 mb-4">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="bi bi-currency-dollar"></i>
                Doanh thu theo thời gian
              </h3>
            </div>
            <div class="chart-body">
              <div class="chart-container">
                <div class="simple-chart">
                  <div class="chart-bars">
                    @for (revenue of analyticsData.revenue; track revenue.date) {
                      <div class="chart-bar revenue-bar" [style.height.%]="getRevenueBarHeight(revenue.amount)">
                        <div class="bar-value">{{ formatCurrencyShort(revenue.amount) }}</div>
                      </div>
                    }
                  </div>
                  <div class="chart-labels">
                    @for (revenue of analyticsData.revenue; track revenue.date) {
                      <div class="chart-label">{{ formatDate(revenue.date) }}</div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Section -->
    <div class="insights-section">
      <div class="row">
        <div class="col-lg-8">
          <div class="insights-card">
            <h3 class="insights-title">
              <i class="bi bi-lightbulb"></i>
              Nhận xét & Gợi ý
            </h3>
            <div class="insights-content">
              <div class="insight-item positive">
                <i class="bi bi-check-circle"></i>
                <div class="insight-text">
                  <strong>Dữ liệu thật:</strong> Tất cả số liệu được lấy từ database thực tế
                </div>
              </div>
              <div class="insight-item neutral">
                <i class="bi bi-info-circle"></i>
                <div class="insight-text">
                  <strong>Lưu lượng truy cập:</strong> Trung bình {{ formatNumber(analyticsData.totalViews / analyticsData.views.length) }} lượt xem/ngày
                </div>
              </div>
              <div class="insight-item suggestion">
                <i class="bi bi-arrow-right-circle"></i>
                <div class="insight-text">
                  <strong>Gợi ý:</strong> Theo dõi xu hướng để tối ưu hóa chiến lược bán hàng
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="quick-stats-card">
            <h3 class="stats-title">Thống kê nhanh</h3>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-label">Tổng đơn hàng</div>
                <div class="stat-value">{{ getTotalOrders() }}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Doanh thu cao nhất</div>
                <div class="stat-value">{{ formatCurrencyShort(getMaxRevenue()) }}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Lượt xem cao nhất</div>
                <div class="stat-value">{{ formatNumber(getMaxViews()) }}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Thời gian</div>
                <div class="stat-value">{{ getSelectedPeriodLabel() }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  } @else {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="bi bi-graph-down"></i>
      </div>
      <h3>Không có dữ liệu</h3>
      <p>Chưa có dữ liệu phân tích nào để hiển thị</p>
      <button class="btn btn-primary" (click)="loadAnalyticsData()">
        <i class="bi bi-arrow-clockwise"></i>
        Tải lại
      </button>
    </div>
  }
</div>